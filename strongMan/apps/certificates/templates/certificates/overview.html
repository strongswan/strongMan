{% extends "base.html" %}
{% load i18n %}
{% comment %}
    Input:
    :param publics: list of certificates
    :type publics: [models.Certifacte]
    :param view: indicates which filter has been applied
    :type view: "all" | "root" | "entities"
    :param search_pattern: the search pattern, that the user has typed in
    :type search_pattern: String
    :param readonly: Indicates if the view is readonly
    :type readonly: boolean
{% endcomment %}
{% block title %}Certificates{% endblock title %}
{% block small-title %}Overview{% endblock small-title %}

{% block content %}
    <div id="certificate-overview">
        <div class="row" id="header">
            <div class="col-md-10 col-xs-9 btn-group" role="group">
                <a href="{% url "certificates:overview" %}" {% if view == "all" %}disabled="True" {% endif %}
                   class="btn btn-default">
                        <span title="Show all certificates">All</span>
                </a>
                <a href="{% url 'certificates:overview_ca' %}" {% if view == "root" %}disabled="True" {% endif %}
                   class="btn btn-default">
                        <span title="Show only root certificates">Root</span>
                </a>
                <a href="{% url 'certificates:overview_certs' %}" {% if view == "entities" %}disabled="True" {% endif %}
                   class="btn btn-default">
                        <span title="Show only entity certificates">Entities</span>
                </a>
                <a href="{% url 'certificates:overview_vici' %}" {% if view == "vici" %}disabled="True" {% endif %}
                   class="btn btn-default">
                        <span title="Shows the certificates provided by the vici interface">Vici</span>
                </a>
            </div>
            <div class="pull-right" id="add-btn">
                <span title="Add a new key container">
                    <a href="{% url "certificates:add" %}" type="button" class="btn btn-orange btn-lg"
                       aria-label="Left Align">
                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add
                    </a>
                </span>

            </div>
        </div>


        <div class="row" id="search">
            <form action="" method="POST" style="display: inline;">
                {% csrf_token %}
                <input type="hidden" name="page" value="1">
                <div class="col-lg-6">
                    <div class="input-group">
                        <input class="form-control" type="text" name="search_text" value="{{ search_pattern }}"
                               placeholder="Filter your certificates by domain names">
                        <div class="input-group-btn">
                            <button type="submit" class="btn btn-default" type="button" name="search"><span
                                    class="glyphicon glyphicon-search"></span> Search
                            </button>
                            <a href="" class="btn btn-default" {% if search_pattern == "" %}disabled="True"{% endif %}
                               name="clear">
                                <span class="glyphicon glyphicon-remove"></span> Clear
                            </a>
                        </div>
                    </div>
                </div>
            </form>


        </div>

        {% if publics %}
            <div class="row">
                <div class="col-lg-12">
                    <div class="">
                        {% if view == "vici" %}
                            {% include "certificates/widgets/ViciCertificateTable_view.html" with certificates=publics %}
                        {% else %}
                            {% include "certificates/widgets/CertificateModelTable_view.html" with certificates=publics %}
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="my-pagination row">
                <div class="text-center">
                    {% if publics.has_previous %}
                        <form action="" method="POST" class="pagination-form">
                            {% csrf_token %}
                            <input type="hidden" name="search_text" value="{{ search_pattern }}">
                            <input type="hidden" name="page" value="{{ publics.previous_page_number }}">
                            <button type="submit" class="btn btn-default" name="next">
                                <span class="glyphicon glyphicon-chevron-left"></span> Previous
                            </button>
                        </form>
                    {% endif %}

                    <span class="current">
                        Page {{ publics.number }} of {{ publics.paginator.num_pages }}
                    </span>

                    {% if publics.has_next %}
                        <form action="" method="POST" class="pagination-form">
                            {% csrf_token %}
                            <input type="hidden" name="search_text" value="{{ search_pattern }}">
                            <input type="hidden" name="page" value="{{ publics.next_page_number }}">
                            <button type="submit" class="btn btn-default" name="next">
                                Next <span class="glyphicon glyphicon-chevron-right"></span>
                            </button>
                        </form>
                    {% endif %}
                </div>
            </div>
        {% else %}
            <div class="row" id="no_certs_to_show">
                <h3>No certificates to show</h3>
            </div>
        {% endif %}
    </div>
{% endblock content %}